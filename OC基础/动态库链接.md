## 动态库链接

静态库是编译时链接的库，会链接进Mach-o文件中，如果有更新就要重新编译一次，无法动态加载和更新；动态库是运行时链接的库，使用dyld可以实现动态加载

Mach-o是编译后的产物，而动态库在运行时才会被链接，因此Mach-o文件中没有包含动态库里的符号定义，这些符号会显示为"未定义"。这些符号的名字和对应的库的路径会被记录下来，运行时通过dlopen和dlsym导入动态库，先根据记录的库路径找到对应的库，再通过记录的符号找到绑定的地址

dlopen会把动态库载入运行进程的地址空间，载入的动态库也会有未定义的符号，这样会触发更多的动态库载入。dlopen打开动态库后返回的是引用的指针，dlsym的作用是通过dlopen返回的动态库指针和函数符号，得到函数的地址然后使用

使用dyld加载动态库分以下两种方式

- 程序启动加载时绑定
- 符号第一次被用到时绑定

一般来说都是采用第二种方式

### dyld的工作

dyld的工作如下
- 先执行Mach-o文件，根据文件中undefined的符号加载对应的动态库，系统会设置一个共享缓存来解决加载的递归依赖问题
- 加载后，将undefined的符号绑定到动态库对应的地址上
- 最后处理+load()方法，main函数返回后运行static terminator

### injection for xcode

injection可以通过动态库的方式实现动态极速调试
